# Лабораторная работа №6 — Рефакторинг и code smells

Рефакторинг кода обработки заказа без изменения поведения.

## Найденные code smells

- Большая функция `process_checkout` с несколькими обязанностями (валидация, расчёты, форматирование).
- Повторяющиеся циклы по `items` (валидация и подсчёт subtotal).
- Магические числа и строки (0.21, 0.10, 200, "USD" и т.д.).
- Сложная вложенность условий в расчёте скидки.
- Нарушение принципов DRY и KISS.

## Применённые рефакторинги

1. Вынесены магические значения в именованные константы в начале файла.
2. Логика разбита на отдельные функции с одной ответственностью:
   - `parse_request` — извлечение данных
   - `validate_request` — вся валидация
   - `calculate_subtotal` — подсчёт суммы
   - `calculate_discount` — расчёт скидки
3. Функция `process_checkout` стала короткой и читается сверху вниз как сценарий.
4. Упрощена обработка отрицательной суммы после скидки с помощью `max()`.
5. Все изменения выполнялись маленькими шагами с постоянной проверкой тестов.

После рефакторинга код стал значительно проще читать, понимать и расширять (например, добавить новый купон — только в одной функции). Поведение полностью сохранено — все тесты продолжают проходить.

Файлы:
- `order_processing.py` — отрефакторенный код
- `test_order_processing.py` — тесты (4 passed)
- `requirements.txt` — pytest

Ссылка на репозиторий: https://github.com/RyzhkevichMaria/lab6-refactoring
